input {
	file {
		path => "/tmp/logs/nginx_access.log"
		start_position => "beginning"
		# sincedb_path => "/dev/null"
	}
}

## Add your filters / logstash plugins configuration here

filter {
	grok {
		match => {
			"message" => '(?<Remote_Address>[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}) - - \[(?<Request_Date>[^ ]+ \+[0-9]+)\] "(?<Request_Method>[A-Z]+) (?<Request_URL>[^ ]+) (?<Request_Protocol>[^ ]+)" (?<Status_Code>[0-9]+) (?<Content-Length>[0-9]+) "(?<Referrer>[^"]+)" "(?<User-Agent>[^"]+)"'
		}
		remove_field => [ "message", "@version", "path" ]
	}
	date {
		match => [ "Request_Date" , "dd/MMM/yyyy:HH:mm:ss Z" ]
		remove_field => ["timestamp"]
	}
}

output {
	elasticsearch {
		hosts => "elasticsearch:9200"
		user => "elastic"
		password => "changeme"
	}
}
